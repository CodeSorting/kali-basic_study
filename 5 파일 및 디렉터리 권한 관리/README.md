# 칼리 리눅스 실습 5

## 권한, 소유권
 - 루트 사용자는 모든 권한을 가지고 있다. 시스템에서 모든 것을 수행할 수 있다.
 - 다른 사용자는 제한된 기능과 권한을 가진다.
 - 보통은 그룹으로 묶여 있다. 비슷한 요구사항을 가진 사람들을 관련 권한이 부여된 그룹에 배치한 다음 그룹의 각 구성원이 그룹 권한을 상속하는 것이다.
 - 루트 사용자는 기본적으로 루트 그룹의 일부다. 
 1. r : 읽기 권한, 열기,보기만 가능
 2. w : 쓰기 권한, 사용자가 파일을 보고 수정할 수 있음.
 3. x : 실행 권한, 사용자가 파일을 실행할 수 있게 함.
 - 파일의 소유권을 다른 사용자에게 전달하려면 chown(change owner) 명령을 사용할 수 있다.
 - chown bob /tmp/bobsfile : bob이라는 사용자 계쩡에 bobsfile 소유권을 승인한다.
 - 파일의 소유권을 한 그룹에서 다른 그룹으로 이전하는 것은 chgrp(change group) 명령이다.
 - chgrp security newIDS : security 그룹에 newIDS의 소유권을 전달한다.
 - ls -l로 파일의 권한을 점검할 수 있다.
  drwxr-xr-x : 파일의 종류(d:directory,-:file),소유자,그룹,사용자 각각에 대해 rwx 파일 권한
  링크 개수(동일한 데이터를 가리키는 또 다른 이름의 수), 파일 소유자, 파일 바이트 수, 파일이 생성되거나 마지막으로 수정된 시간, 파일의 이름 순으로 나타낸다.
 - chmod : 권한을 변경할 수 있다. 권한을 변경하기 위해서 숫자를 쓰거나 기호 표현을 쓸 수 있다.
 1. 수 표현 : 권한도 2진수로 표현되니 7=rwx,2=-w- 이런식으로 변환이 가능하다. 따라서 소유자,그룹,기타 사용자에 대해 모든 권한을 주고 싶으면 777로 둘 수 있다.
 chmod 774 hashcat.hcstat -> -rwxrwxr--이다.
 2. UGO를 통한 권한 변경 : u: 사용자, g: 그룹, o: 기타 사용자, -: 권한 제거, +: 권한 추가, =: 권한 설정
 chmod u-w hashcat.hcstat : 파일 권한 중 사용자를 위한 쓰기 권한을 제거한다.
 chmod u+w, o+x hashhcat.hcstat : 파일 권한 중 사용자를 위한 쓰기 권한을 추가하고, 기타 사용자에게 실행 권한을 준다.
 - 새 해킹 도구를 해커는 자주 다운로드 받는다. 그러나 리눅스는 모든 파일과 디렉터리에 기본권한 666,777을 각각 부여한다.
 - 이는 기본적으로 다운로드 직후에는 파일을 실행할 수 없다는 뜻이다. 실행하면 Permission denied 같은 메시지를 보게 된다.
 - 이런 경우 파일의 실행을 위해 chmod를 사용해 스스로 루트와 실행 권한을 부여할 필요가 있다.
 - 이럴 경우 chmod 766 파일이름 을 입력하면 실행 권한이 부여돼 실행이 가능하다.

## 마스크를 통한 더 안전한 기본 권한 설정
 - umask : 각 사용자에게 생성된 파일 및 디렉터리에 할당되는 기본 권한을 변경할 수 있다.
 새 파일 새 디렉터리<br>
 666     777 리눅스 기본 권한<br>
 -022    -022 umask<br>
 644     755  최종 권한<br>
 - 각 사용자는 본인의 파일 및 디렉터리를 위한 개인별 기본 umask 값을 .profile 파일에 설정할 수 있다.
 - /home/username/.profile을 편집하여 umask 007을 추가한다면 사용자와 사용자의 그룹의 구성원만 권한을 가지게 된다.

## 특수 권한
 - 3개의 rwx와 더불어 리눅스는 3개의 특수 권한을 제공한다. 각각 Set User ID(SUID), Set Group ID(SGID), sticky 비트이다.
 - 어떤 파일이 실행 중에 루트가 아닌 모든 사용자를 위해 루트 사용자 권한이 필요하다고 해보자.
 - 예를 들어, 비밀번호를 변경하도록 하는 파일은 /etc/shadow 파일로의 접근이 필요하다. 이를 위해서는 루트 사용자 권한이 필요하다.
 - 이런 경우 SUID 비트를 설정함으로써 해당 파일을 소유자의 권한으로 실행할 수 있도록 임시 승인할 수 있다.
 - 일반적인 권한 앞에 4를 입력하면 된다. 파일의 권한이 644인 경우 4644가 된다.
 - SGID도 임시적인 권한 상승을 승인한다. 그러나 파일 소유자 그룹의 권한을 승인한다. SGID 비트는 일반 권한 직전에 2를 붙인다.
 - sticky bit는 디렉터리에 설정할 수 있는 권한 비트로서 사용자가 해당 디렉터리 내의 파일을 삭제하거나 이름을 바꿀 수 있게 허용한다.
 - 그러나 현대 리눅스에서는 사라진 개념이다.
 - 이러한 특수 권한 상승을 이용해 리눅스 시스템을 해커가 취할 수 있다. 보통 사용자는 이를 통해 root,sysadmin 권한 및 관련 권한을 갖는다.
 - 이를 위해 find / -user root -perm -4000 -> 파일 시스템 최상단(/)부터 소유자가 root이며 SUID 권한 비트가 설정된(-perm -4000) 모든 파일을 탐색한다.
 - 이 같은 파일이 해커의 잠재적인 공격 지점일 수 있다.