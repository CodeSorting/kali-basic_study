# 칼리 리눅스 실습 13

## 익명성
 - 오늘날 인터넷의 우리가 하는 행동은 모두 기록,인덱싱되며 누군가의 이익을 위해 축적된다. 이런 추적을 제한하는 방법을 알아야한다.
 - 월드 와이드 웹의 탐색을 익명(또는 최대한 가깝게 하는법)을 배운다.
 - 4가지 방법이 있다. onion network(어니언 네트워크), proxy server(프록시 서버), VPN(가상 사설 네트워크), 사설 암호화 이메일이 그 4가지이다.

### 인터넷이 우리를 드러내는 방법
 - 먼저 IP주소를 통해 인터넷을 탐험하는 사용자를 식별한다. 전송하는 데이터 안에 IP주소가 있고, 활동의 추적을 쉽게 해준다.
 - 둘째로 구글이나 기타 이메일 서비스는 키워드 탐색을 통해 광고를 효율적으로 제공하기 위해 우리의 이메일을 읽는다.
 - 이제 한번 패킷을 전송할 때를 자세히 봐보자.
 - 패킷을 전송할 때 어디로 가는지, 내 주소는 어딘지 여러 홉을 거쳐서 간다.
 - 어떤 경로로 갔는지 알기 위해 traceroute를 쓸 수 있다.
 - traceroute google.com 
 ```
 -> traceroute to google.com (172.217.7.78), 30 hpos max, 60 bytes packets
 1 192.168.1.1 (192.168.1.1) 4.152 ms 3.834 ms 32.964 ms
 2 10.0.0.1 ....
 18 lgal15s44-in-f14.le100.net (172.217.1.78) 94.666 ms 42.990 ms 41.564 ms
 ```
 - 위에서 보듯 google.com은 18번 홉을 거쳐서 간다. 패킷의 경로는 바뀌기도 하지만 이러한 패킷을 변조시키는 것이 훨씬 익명성이 보장된다.
 - Tor(토르) 네트워크를 이용해서 이 모두를 변조시키는 방법을 알아보자.

## 어니언 라우터 시스템
 - 1990년대 미국 해군 연구청에서 스파이 목적으로 익명인 상태로 인터넷을 돌아다니기 위한 방법 개발을 계획했다. 이 계획은 인터넷의 라우터와 분리되며, 트래픽을 암호화할 수 있으며,
 직전 라우터의 IP주소만 암호화하여 저장하는 네트워크 라우터를 구축하는 것이었다. 이러한 연구는 2002년 어니언 라우터 프로젝트(The Onion Router,TOR)로 알려졌다.
 - 토르의 패킷은 일반적인 라우터가 아닌 토르로 사용되도록 지원한 7천여개의 라우터 네트워크로 보내진다.
 - 완전히 분리된 라우터 네트워크를 사용하여 토르는 각 패킷의 데이터,목적지,송신자 IP주소를 암호화한다. 각 홉에서 암호화, 다음 홉에서 복호화,다시 암호화하여 전송..으로 이루어진다.
 - https://www.torproject.org/ 에서 토르브라우저를 설치하기만 하면 된다.
 - 그러나 토르브라우저는 매우 느리다. 라우터가 많지 않고 대역폭이 제한되기 때문이다.
 - 토르 브라우저는 다크 웹에 접근하는 것도 가능하다. 이들은 토르 브라우저를 통한 접속만 허용한다. 그리고 최상위 도메인으로 .onion을 사용하는 주소를 갖는다.
 - 그러나 토르의 익명성은 깨졌다. 한 예로 NSA는 그들 고유의 토르 라우터를 실행한다. 즉, 토르를 사용하면 트래픽이 NSA의 라우터를 거쳐갈 수도 있고 NSA를 벗어나면
 트래픽이 떠난 라우터는 트래픽의 목적지를 알고 있기 때문에 스파이 요원으로부터 숨길 수는 없다. 그러나 구글 같은 상업 서비스로부터 사용자의 신원을 숨길 수는 있다.

## 프록시 서버
 - 프록시는 중간자 역할을 하는 시스템이다. 사용자가 프록시에 접속하고 트래픽은 통과하기 전에 프록시의 IP 주소를 부여받는다.
 - 트래픽이 목적지에서 되돌아오면 프록시는 트래픽을 출처로 되돌려 보낸다. 이런 식으로 트래픽은 본래의 IP 주소가 아닌 프록시로부터 나온 것처럼 보인다.
 - 물론 프록시가 트래픽을 기록할 가능성이 높다. 그래도 조사관이 기록을 얻으려면 소환장이나 영장이 필요하다.
 - 추적을 더 어렵게 하기 위해 프록시 체인(프록시 여러개 사용)을 이용하기도 한다.
 - 칼리는 트래픽을 숨기도록 설정하는 proxychains [프록시할 명령어] [인자] 명령이 있다.
 - 익명으로 nmap을 통해 사이트를 스캔하고 싶다면 proxychains nmap -sT -Pn [ip주소]를 입력하면 된다.
 - /etc/proxychains4.conf에서 proxychains 명령이 사용할 프록시를 설정할 수 있다.
 - vi /etc/proxychains4.conf -> 61번째 줄에 ProxyList가 있따. 여기에 사용하고자 하는 프록시의 IP 주소와 포트를 입력하면 프록시를 추가할 수 있다.
 - 구글에 무료 프록시를 검색하거나 https://www.hidemy.name 사이트를 이용하면 무료 프록시를 찾을 수 있다. 그러나 무료 프록시를 사용하는 것은 좋은 것이 아니다.
 - https://www.hidemy.name에서 양식을 채우고 show를 클릭하고 나온 프록시 중 하나를 선택하고 proxychains4.conf에 [형태] [ip주소] [포트]를 입력하면 된다.
 - proxychains4에 고유의 프록시를 입력하지 않으면 기본적으로 토르(127.0.0.1 포트 9050)를 사용한다. 
 ```
 [ProxyList]
 # add proxy here...
 socks4 114.134.186.12 22020
 socks4 188.187.190.59 8888
 socks4 181.113.121.158 335551
 이렇게 입력하면 차이점을 못느끼지만 패킷이 다수의 프록시를 통해 돌아다닌다.
 ```
 - proxychains4.conf 파일에 dynamic_chain 주석을 지우면 다중 IP를 통해 동적 체인을 설정할 수 있다. 이는 트래픽이 리스트의 모든 프록시를 거치도록 하는 것으로
 프록시 중 하나가 멈추거나 반응하지 않으면 오류 없이 다음 프록시로 자동으로 이동한다.
 - random_chain의 주석을 해제하면 무작위 체인 옵션이 되어서 리스트에 있는 IP 주소 중 일부를 무작위로 선택하고 프록시 체인을 구성하는데 사용한다.
 - chain_len = 숫자 : chain_len은 random_chain에서 얼마나 많은 ip 주소를 무작위 프록시 쳉니을 생성하는데 사용할 것인지 지정한다.
 - 보안 고려사항으로, 무료 프록시는 우리의 IP주소, 히스토리를 판매할 가능성이 있다. 그러므로 상용 프록시를 사용하는 것이 좋다.
 - proxychains firefox www.google.com -> www.google.com을 프록시를 이용하여 들어가게 된다.

## 가상 사설 네트워크(Virtual Private Network,VPN)
 - VPN은 트래픽에 라우터의 IP 주소를 포함한 궁극적인 목적지로 보내는 중개 인터넷 장치로 접속하는데 사용된다.
 - 그러나 익명성을 보장하지는 않는게 데이터를 적절히 되돌리기 위해 우리의 IP 주소를 VPN 업체가 기록하기 때문이다.
 - 우리는 평소처럼 쓰지만, 감시자 입장에서는 인터넷 VPN 장치의 IP 주소와 위치가 공개되고 VPN 장치와 우리 사이의 트래픽은 모두 암호화된다.
 - 또한 나라 밖의 VPN을 이용한다면 해당 컨텐츠로 접속할 수 있다. 넷플릭스,훌루,HBO같은 미디어 회사는 몇몇 국가에서 기인하는 IP 주소를 제한한다. VPN을 쓴다면 그것을 우회할 수 있다. 
 - IPVanish,NordVPN,ExpressVPN,CyberGhost 등등 여러 업체가 있다.
 - 장점이 모든 트래픽이 암호화되고 우리의 IP 주소를 VPN IP 주소로 가릴 수 있다는 점이다. 그러나 VPN 업체가 정부나 다른 제공자에게 우리의 정보를 줄 수도 있다.

## 암호화된 이메일
 - Gmail,Yahoo,Naver과 같은 무로 상업 이메일 서비스는 무료인 이유가 있다. 그들은 우리의 관심사를 추적하고 광고를 제공한다.
 - 이러한 서버들은 암호화되지 않은 내용에 접근한다. 그러므로 암호화된 이메일을 사용하는 것이 중요하다.
 - ProtonMail(프로톤 메일)은 종단간,브라우저간 이메일을 암호화한다. 프로톤 메일 관리자도 우리의 이메일을 읽을 수 없다.
 - 프로톤 메일 기본 계정에는 요금을 청구하지 않고, 프리미엄 계정에만 조금의 수수료를 청구한다.
 - 그러나 프로톤 메일 사용자가 아닌 사람과 이메일을 서로 보낼 경우 이메일의 일부나 전체가 암호화되지 않을 수도 있다.